<!DOCTYPE html>
    <html>

    <head>
    <title>LDS-006-Lidar-Sensor-Library - Demonstator</title>
    </head>
    <script type="text/javascript">
    var max_distance = 10000;
    var is_started = false;
    var source = null;
    function start() {
        if(window.is_started == true)
            return;
        window.is_started = true;
        
        var canvas = document.getElementById("lidarCanvas");
        x = canvas.width / 2;
        y = canvas.height / 2;
        var ctx = canvas.getContext("2d");

        window.source = new EventSource('/lidar');
        window.source.onmessage = function(event) {
            const data = JSON.parse(event.data)
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.moveTo(x, y);
            ctx.beginPath();
            for(var i = 0; i < 360; i++) {
                var distance = Math.floor( data.values[i] / (max_distance) * x);
                var angle = i * Math.PI / 180;
                var x2 = x + distance * Math.sin(angle);
                var y2 = y + distance * Math.cos(angle);
                ctx.lineTo(x2, y2);
            }
            ctx.stroke();
        }
    }
    function pause() {
        window.source.close();
        window.is_started = false;
    }
    function httpGetAsync(theUrl, callback) {
        let xmlHttpReq = new XMLHttpRequest();
        xmlHttpReq.onreadystatechange = function () {
        if (xmlHttpReq.readyState == 4 && xmlHttpReq.status == 200) callback(xmlHttpReq.responseText);
        };
        xmlHttpReq.open("GET", theUrl, true); // true for asynchronous
        xmlHttpReq.send(null);
    }
    function stop() {
        pause();
        httpGetAsync('/stop', function (data) {
            console.log(data);
            console.log('Stop confirmed.');
        })
    }
    </script>
    <body>
    <h2> Buttons </h2>

    <button onclick="start()">Start</button>
    <button onclick="stop()">Stop</button>
    <button onclick="pause()">Pause</button>
    <br>
    <canvas id="lidarCanvas" width="500" height="500" style="border:1px solid #000000;"></canvas>
    </body>
    </html>